/*C3*/SET SCHEMA PUBLIC
drop view vLikuciai
drop view vLikuciaiInt
drop table likuciai
create table Likuciai (\u000a        Id bigint not null,\u000a        dokumentas varchar(100) not null,\u000a        irasoId bigint,\u000a        prekeId bigint not null,\u000a        imoneId bigint not null,\u000a        matavimoVienetasId bigint not null,\u000a        kiekis numeric not null,\u000a        galiojaIki timestamp,\u000a        serija varchar(100),\u000a        data timestamp not null,\u000a        arSaskaita bit not null,\u000a        zurnaloId bigint null,\u000a        zurnaloVaistoId bigint null,\u000a        saskaitosId bigint null,\u000a        saskaitosPrekesId bigint null,\u000a        pirminisId bigint null,\u000a        primary key (Id),\u000a\u0009   FOREIGN KEY (matavimoVienetasId) REFERENCES MatavimoVienetas(Id),\u000a        FOREIGN KEY (prekeId) REFERENCES Prekes(Id) ,\u000a        FOREIGN KEY (imoneId) REFERENCES Imones(Id) ,\u000a        FOREIGN KEY (zurnaloId) REFERENCES GydomuGyvunuZurnalas(Id) ,\u000a        FOREIGN KEY (zurnaloVaistoId) REFERENCES ZurnaloVaistai(Id) ,\u000a        FOREIGN KEY (saskaitosId) REFERENCES SASKAITOS (ID),\u000a        FOREIGN KEY (saskaitosPrekesId) REFERENCES SASKAITOSPREKES(ID),\u000a        FOREIGN KEY (pirminisId) REFERENCES Likuciai(ID)\u000a    )
create view vLikuciaiInt as \u000aselect l.PREKEID, min(l.MATAVIMOVIENETASID) as MATAVIMOVIENETASID, l.IMONEID, sum(l.KIEKIS) as kiekis, max(l.DATA) as data, min(l.id) as id, sum(Case When l.KIEKIS > 0 Then l.KIEKIS Else 0 End) as pajamuota\u000a\u0009from likuciai l group by l.prekeid, l.imoneid
create view vLikuciai as \u000aselect l.Id, l.kiekis, l.PAJAMUOTA, l.DATA, i.PAVADINIMAS as imone, mv.KODAS as matavimovienetas, p.PAVADINIMAS as preke\u000a\u0009from vLikuciaiInt l left join imones i on l.IMONEID = i.id\u000a\u0009\u0009\u0009\u0009\u0009left join Prekes p on l.PREKEID = p.id\u000a\u0009\u0009\u0009\u0009\u0009left join MATAVIMOVIENETAS mv on mv.id = l.MATAVIMOVIENETASID
DISCONNECT
